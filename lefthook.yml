# Lefthook configuration for Spendex Flutter project
# Install: npm install -g @arkweid/lefthook && lefthook install

pre-commit:
  parallel: true
  commands:
    flutter-format:
      glob: "*.dart"
      run: dart format --set-exit-if-changed {staged_files}
      stage_fixed: true
    
    flutter-analyze:
      glob: "*.dart"
      run: flutter analyze {staged_files}

    check-large-files:
      run: |
        MAX_SIZE=1048576
        for file in {staged_files}; do
          if [ -f "$file" ]; then
            size=$(wc -c < "$file")
            if [ "$size" -gt "$MAX_SIZE" ]; then
              echo "Error: $file is larger than 1MB"
              exit 1
            fi
          fi
        done

    check-debug-statements:
      glob: "*.dart"
      run: |
        if grep -l "print(" {staged_files} 2>/dev/null; then
          echo "Warning: Debug print statements found"
        fi

pre-push:
  parallel: false
  commands:
    flutter-test:
      run: flutter test
      fail_text: "Tests failed! Please fix before pushing."

    flutter-analyze-full:
      run: flutter analyze --fatal-infos
      fail_text: "Analysis failed! Please fix issues before pushing."

commit-msg:
  commands:
    check-commit-message:
      run: |
        MSG=$(cat {1})
        if ! echo "$MSG" | grep -qE "^(feat|fix|docs|style|refactor|perf|test|build|ci|chore|revert)(\(.+\))?: .+"; then
          echo "Error: Commit message does not follow conventional commits format"
          echo "Expected format: type(scope): message"
          echo "Types: feat, fix, docs, style, refactor, perf, test, build, ci, chore, revert"
          exit 1
        fi
